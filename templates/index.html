<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalkulator Metode Secant</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container my-5">
        <div class="text-center mb-4">
            <h2>Kalkulator Metode Secant</h2>
            <p class="lead">Mencari akar fungsi dengan visualisasi tabel iterasi.</p>
        </div>

        <div class="row g-4">
            <div class="col-lg-5">
                <div class="card h-100">
                    <div class="card-header">
                        <h5 class="card-title mb-0">Panel Input</h5>
                    </div>
                     <div class="card-body">
                        <form method="post">
                            <div class="mb-3">
                                <label for="function_preset" class="form-label">Pilih Fungsi</label>
                                <select class="form-select" id="function_preset" name="function_preset">
                                    {% for display, value in preset_functions.items() %}
                                        <option value="{{ value }}" {% if value == function_str %}selected{% endif %}>{{ display }}</option>
                                    {% endfor %}
                                    <option value="custom" {% if function_str not in preset_functions.values() %}selected{% endif %}>-- Masukkan Fungsi Lain --</option>
                                </select>
                            </div>
                            div class="mb-3" id="custom_function_div" style="display:none;">
                                <label for="function_custom" class="form-label">Fungsi Kustom f(x)</label>
                                <input type="text" class="form-control" id="function_custom" name="function_custom" 
                                       value="{{ function_str if function_str not in preset_functions.values() else '' }}" 
                                       placeholder="Contoh: x**3 - 5*x + 1">
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="x0" class="form-label">Tebakan Awal (x₀)</label>
                                    <input type="number" step="any" class="form-control" id="x0" name="x0" value="{{ x0 }}" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="x1" class="form-label">Tebakan Awal (x₁)</label>
                                    <input type="number" step="any" class="form-control" id="x1" name="x1" value="{{ x1 }}" required>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="tolerance" class="form-label">Toleransi Error (ε)</label>
                                <input type="number" step="any" class="form-control" id="tolerance" name="tolerance" value="{{ tol }}" required>
                            </div>
                            <div class="d-grid">
                                <button type="submit" class="btn btn-primary">Hitung Akar</button>
                            </div>
                        </form>
                    </div>
                     <div class="card-footer info-box">
                        <strong>Cara Penggunaan:</strong>
                        <ul>
                            <li>Gunakan <code>x</code> sebagai variabel dan <code>*</code> untuk perkalian.</li>
                            <li>Gunakan <code>**</code> untuk pangkat (contoh: <code>x**2</code>).</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="col-lg-7">
                {% if message %}
                    <div class="alert {% if result is not none %}alert-success{% else %}alert-danger{% endif %} mb-4">
                        <h4 class="alert-heading">{% if result is not none %}Hasil Perhitungan{% else %}Status{% endif %}</h4>
                        {% if result is not none %}
                            <p class="mb-1"><strong>Akar yang ditemukan:</strong> <span class="result-highlight">{{ "%.8f"|format(result) }}</span></p>
                        {% endif %}
                        <p class="mb-1"><strong>Jumlah Iterasi:</strong> {{ iterations_data|length }}</p>
                        <p class="mb-0"><strong>Pesan:</strong> {{ message }}</p>
                    </div>
                {% endif %}

                {% if iterations_data %}
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">Tabel Iterasi</h5>
                    </div>
                    <div class="table-container">
                        <table class="table table-striped table-bordered table-hover mb-0">
                            <thead class="table-dark">
                                <tr>
                                    <th>n</th>
                                    <th>x₀</th>
                                    <th>x₁</th>
                                    <th>f(x₀)</th>
                                    <th>f(x₁)</th>
                                    <th>x₂ (hasil)</th>
                                    <th>Error |x₂-x₁|</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for row in iterations_data %}
                                <tr>
                                    <td>{{ row.iter }}</td>
                                    <td>{{ "%.6f"|format(row.x0) }}</td>
                                    <td>{{ "%.6f"|format(row.x1) }}</td>
                                    <td>{{ "%.6f"|format(row.fx0) }}</td>
                                    <td>{{ "%.6f"|format(row.fx1) }}</td>
                                    <td><b>{{ "%.6f"|format(row.x_next) }}</b></td>
                                    <td>{{ "%.6f"|format(row.error) }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
                {% else %}
                <div class="card h-100">
                     <div class="card-body d-flex justify-content-center align-items-center">
                        <div class="text-center text-muted">
                            <p class="fs-4">Hasil perhitungan akan muncul di sini.</p>
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

